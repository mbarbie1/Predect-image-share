<html>

<head>
  
	<meta charset="utf-8">
	<title>Fake WebMicroscope: testing 3D fluorescent image handling</title>

<!-- CSS: -->
	<!-- styles needed by slider -->
	<link rel="stylesheet" href="external/jquery-ui-1.11.1/jquery-ui.css"/>

    <style type="text/css">
        html {
            font-family: Verdana, sans-serif;
        }
		#view {
			width: 800px;
			height: 400px;
		}
        #container {
            width: 1000px;
            height: 500px;
            background-color: black;
            border: 1px solid black;
            color: white;   /* text color for messages */
        }
		.overlay {
			border: 1px solid #FFCC33;
			padding:2px;
			background-color:#666666
		}

		#icons {
			margin: 0;
			padding: 0;
		}
		#icons li {
			margin: 2px;
			position: relative;
			padding: 4px 0;
			cursor: pointer;
			float: left;
			list-style: none;
		}
		#icons span.ui-icon {
			float: left;
			margin: 0 4px;
		}
		.pixelated {
			image-rendering:optimizeSpeed;             /* Legal fallback */
			image-rendering:-moz-crisp-edges;          /* Firefox        */
			image-rendering:-o-crisp-edges;            /* Opera          */
			image-rendering:-webkit-optimize-contrast; /* Safari         */
			image-rendering:optimize-contrast;         /* CSS3 Proposed  */
			image-rendering:crisp-edges;               /* CSS4 Proposed  */
			image-rendering:pixelated;                 /* CSS4 Proposed  */
			-ms-interpolation-mode:nearest-neighbor;   /* IE8+           */
		}
	</style>

<!-- JavaScript: -->
	<script type="text/javascript" src="external/jquery/jquery-1.11.1.js"></script>
	<script type="text/javascript" src="external/jquery-ui-1.11.1/jquery-ui.js"></script>

</head>

<body>

    <div id="view" class="pixelated" ></div>

    <script src="javascripts/external/openseadragon/openseadragon-bin-1.1.1/openseadragon.min.js"></script>
    <script src="javascripts/external/openseadragonscalebar/openseadragon-scalebar.js"></script>
	
		<!-- Control de brillo -->
		<div style="overflow:hidden">
			 <div id="radio" style="float:left">
				<input type="radio" id="radio2" name="radio" onClick="actualizarTipo(false)" checked="checked" /><label for="radio2">Imagen original</label>		
				<input type="radio" id="radio1" name="radio" onClick="actualizarTipo(true)" /><label for="radio1">Brillo/Contraste</label>		
			</div>

			<div id="slide_1" style="display:none; float:left; overflow:hidden; margin-top:10px; margin-left:20px">
				
				<div id="slider-range-max" style="width:150px; float:left"></div>
				<div style="float:left">
				<label for="amount" >Brillo:</label>
				<input type="text" id="amount" style="border: 0; color: #f6931f; font-weight: bold; width:30px" />
				</div>

			</div>
			
			<div id="slide_2" style="display:none; float:left; overflow:hidden; margin-top:10px; margin-left:20px">
				<div id="slider-range-max-2" style="width:150px; float:left"></div>
				<div style="float:left">
					<label for="amount-2" >Contraste:</label>
					<input type="text" id="amount-2" style="border: 0; color: #f6931f; font-weight: bold; width:30px" />
				</div>
			</div>
		</div>
		<!-- fin Control de brillo -->	

		<!-- Buttons -->
		<ul id="icons" class="ui-widget ui-helper-clearfix">
			<li class="ui-state-default ui-corner-all" title="Zoom +" onClick="zoom(1.5)"><span class="ui-icon ui-icon-plusthick"></span></li>
			<li class="ui-state-default ui-corner-all" title="Zoom -" onClick="zoom(0.75)"><span class="ui-icon ui-icon-minusthick"></span></li>
			<li class="ui-state-default ui-corner-all" id="pan_herramienta" title="Panning"><span class="ui-icon ui-icon-arrow-4-diag"></span></li>
			<li class="ui-state-default ui-corner-all" id="overlay_herramienta"  title="Marcar punto"><span class="ui-icon ui-icon-info"></span></li>
		</ul>
		<!-- End Buttons -->



		
		
		<!-- Filters -->
		<div id="controls">
			<h4>Play with the sliders…</h4>
			<form class="form-horizontal">
					<div class="control-group">
						<label class="control-label" for="grayscale">Grayscale</label>
						<div class="controls">
							<input type="range" data-default=0 value=0 min=0 max=1 step=0.1 id="grayscale" />
							<p id="grayscale_output" class='pull-right'></p>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="sepia">Sepia</label>
						<div class="controls">
							<input type="range" data-default=0 value=0 min=0 max=1 step=0.1 id="sepia" />
							<p id="sepia_output" class='pull-right'></p>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="saturate">Saturate</label>
						<div class="controls">
							<input type="range" data-default=1 value=1 min=0 max=1 step=0.1 id="saturate" />
							<p id="saturate_output" class='pull-right'></p>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="hue-rotate">Hue-rotate</label>
						<div class="controls">
							<input type="range" data-default=0 value=0 min=0 max=360 step=1 id="hue-rotate" />
							<p id="hue-rotate_output" class='pull-right'></p>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="invert">Invert</label>
						<div class="controls">
							<input type="range" data-default=0 value=0 min=0 max=1 step=0.1 id="invert" />
							<p id="invert_output" class='pull-right'></p>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="opacity">Opacity</label>
						<div class="controls">
							<input type="range" data-default=1 value=1 min=0 max=1 step=0.1 id="opacity" />
							<p id="opacity_output" class='pull-right'></p>
						</div>
					</div>
										<div class="control-group">
						<label class="control-label" for="brightness">Brightness</label>
						<div class="controls">
							<input type="range" data-default=1 value=1 min=0 max=1 step=0.1 id="brightness" />
							<p id="brightness_output" class='pull-right'></p>
						</div>
					</div>
										<div class="control-group">
						<label class="control-label" for="contrast">Contrast</label>
						<div class="controls">
							<input type="range" data-default=1 value=1 min=0 max=2 step=0.1 id="contrast" />
							<p id="contrast_output" class='pull-right'></p>
						</div>
					</div>
										<div class="control-group">
						<label class="control-label" for="blur">Blur</label>
						<div class="controls">
							<input type="range" data-default=0 value=0 min=0 max=10 step=1 id="blur" />
							<p id="blur_output" class='pull-right'></p>
						</div>
					</div>
										<div class="control-group">
						<label class="control-label" for="reset">&nbsp;</label>
						<div class="controls">
							<a href='#' id='reset' class='btn btn-info'>Reset to defaults</a href='#'>
							</div>
						</div>
					</form>
				</div>
		
		
	<script>

	
		var um = 0.000001;
		// TODO: get pixelsize from image metadata (which should be available when an image is opened)
		var pixelSizeX = 1.3;
		var pixelSizeY = 1.3;
		var pixelSizeZ = 10;

		var viewer = OpenSeadragon({
			id:					'view',
			prefixUrl:			'javascripts/external/openseadragon/openseadragon-bin-1.1.1/images/',
			//tileSources:  		'data/images/dzi/b09/GeneratedImages/dzc_output.xml',
			tileSources:  		'data/images/dzi/test_rgb_image/GeneratedImages/dzc_output.xml',
			minZoomLevel:		1/4,
			maxZoomLevel:		32,
			visibilityRatio:	1,
			immediateRender:	true,
			zoomPerScroll:		2,
			zoomPerClick:		2,
			minPixelRatio:		1,
			useCanvas:			true
		});
		viewer.scalebar({
			type: OpenSeadragon.ScalebarType.MICROSCOPE,
			pixelsPerMeter: 1/(pixelSizeX*um),
			minWidth: "75px",
			location: OpenSeadragon.ScalebarLocation.BOTTOM_LEFT,
			xOffset: 10,
			yOffset: 15,
			stayInsideImage: true,
			color: "rgb(255, 255, 0)",
			fontColor: "rgb(255, 255, 0)",
			backgroundColor: "rgba(255, 255, 255, 0)",
			fontSize: "large",
			barThickness: 5
		});

		$(document).ready(function() {
			var controls_input = $("#controls input"),
			image = $(".filtered img");

			function updateDisplay() {
				var newCSS = '';
				controls_input.each(function(){
					var units = '';

					if ($(this).attr('id') == 'blur') {
						units = 'px';
					} else if ($(this).attr('id') == 'hue-rotate') {
						units = 'deg';
					}
					newCSS += $(this).attr('id')+"("+$(this).val()+units+") ";
					$("#"+$(this).attr('id')+"_output").text($(this).attr('id')+"("+$(this).val()+units+")");
				});
				image.css("-webkit-filter", newCSS);
				image.css("-moz-filter", newCSS);
				image.css("-ms-filter", newCSS);
				image.css("-o-filter", newCSS);
				image.css("filter", newCSS);
			}
			updateDisplay();

			controls_input.change(updateDisplay);

			$("#reset").click(function(){
				controls_input.each(function(){
					$(this).val($(this).attr('data-default'));
				});
				updateDisplay();
				return false;
			});
		});

		$(function() {

		   var brilloGlobal = 0.1;
		   var contrasteGlobal 	= 1;
		   var PRECISION = 8;   // número de decimales en puntos

		   var apliicarBrillo = false;

		   $( "#radio" ).buttonset();
		   $( "#slider-range-max" ).slider({
				range: "max",
				min: 0.0,
				max: 1000.0,
				value: 0.5,
				step: 0.5,
				slide: function( event, ui ) {
					$( "#amount" ).val( ui.value );
					brilloGlobal = ui.value;
					viewer.drawer.reset();
				}
			});

			$( "#slider-range-max-2" ).slider({
				range: "max",
				min: 1,
				max: 200000,
				value: 1,
				step: 5,
				slide: function( event, ui ) {
					$( "#amount-2" ).val( ui.value );
					contrasteGlobal = ui.value;
					viewer.drawer.reset();
				}
			});

			$( "#amount" ).val( $( "#slider-range-max" ).slider( "value" ) );
			$( "#amount-2" ).val( $( "#slider-range-max-2" ).slider( "value" ) );

			/*Botones*/
			$('#overlay_herramienta').click(function() {
				Seadragon.Utils.addEvent(viewer.elmt, "click", mouse_click);
			});

			$('#pan_herramienta').click(function() {
				Seadragon.Utils.removeEvent(viewer.elmt, "click", mouse_click);
			});

		});

		function actualizarTipo(valor) {

			apliicarBrillo = valor;

			if(apliicarBrillo){
				$('#slide_1').show();
				$('#slide_2').show();
			}else{
				$('#slide_1').hide();
				$('#slide_2').hide();
			}
			viewer.drawer.reset();
        }
		
    </script>

</body>
  
</html>